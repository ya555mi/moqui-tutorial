<?xml version="1.0" encoding="UTF-8"?>

<services xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/service-definition-2.1.xsd">

    <!-- Order & Related Services -->
    <service verb="get" noun="FemalePersons" displayName="get the female person details">
        <in-parameters>
            <parameter name="gender" default-value="F"/>
        </in-parameters>
        <out-parameters>
            <parameter name="personList" type="list" required="true"/>
        </out-parameters>
        <actions>
            <entity-find entity-name="mantle.party.Person" list="personList">
                <econdition field-name="gender"/>
            </entity-find>
        </actions>
    </service>

    <service verb="get" noun="Persons" displayName="get the person details">
        <in-parameters>
            <parameter name="maritalStatusEnumId" default-value="MarsMarried"/>
        </in-parameters>
        <out-parameters>
            <parameter name="personList" type="list" required="true"/>
        </out-parameters>
        <actions>
            <entity-find entity-name="mantle.party.Person" list="personList">
                <econdition field-name="maritalStatusEnumId"/>
            </entity-find>
        </actions>
    </service>

    <service verb="get" noun="LatestOrders" displayName="get the Latest order">
        <out-parameters>
            <parameter name="ordersList" type="list" required="true"/>
        </out-parameters>
        <actions>
            <entity-find entity-name="mantle.order.OrderHeader" list="ordersList">
                <order-by field-name="placedDate"/>
            </entity-find>
        </actions>
    </service>

    <service verb="get" noun="Order" displayName="get the person details">
        <in-parameters>
            <parameter name="orderId" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="ordersList" type="list" required="true"/>
        </out-parameters>
        <actions>
            <entity-find-one entity-name="mantle.order.OrderHeader" value-field="ordersList">
                <field-map field-name="orderId"/>
            </entity-find-one>
        </actions>
    </service>

    <service verb="get" noun="OrderHeaders" displayName="get the grand_total details">
        <out-parameters>
            <parameter name="orderCount" type="list" required="true"/>
        </out-parameters>
        <actions>
            <set field="orderCount" from="[]"/>
            <entity-find entity-name="mantle.order.OrderHeader" list="ordersList">
            </entity-find>
            <iterate list="ordersList" entry="orderInfo">
                <if condition="orderInfo.grandTotal &gt; 50">
                    <then>
                        <set field="orderCount" from="orderCount+[orderId:orderInfo.orderId,orderName:orderInfo.orderName,
                        placedDate:orderInfo.placedDate,statusId:orderInfo.statusId,currencyUomId:orderInfo.currencyUomId
                       ,productStoreId:orderInfo.productStoreId,grandTotal:orderInfo.grandTotal ]"/>
                    </then>
                </if>
            </iterate>
        </actions>
    </service>


    <service verb="get" noun="OrderItems" displayName="get the grand_total details">
        <in-parameters>
            <parameter name="orderId" default-value="100102"/>
            <parameter name="orderPartSeqId" default-value="01"/>
        </in-parameters>
        <out-parameters>
            <parameter name="orderItemList" type="list" required="true"/>
        </out-parameters>
        <actions>
            <entity-find entity-name="mantle.order.OrderItem" list="orderItemList">
                <econdition field-name="orderId"/>
                <econdition field-name="orderPartSeqId"/>
            </entity-find>
        </actions>
    </service>

    <service verb="get" noun="OrderParts" displayName="get the part_total details">
        <out-parameters>
            <parameter name="entityCount" type="list" required="true"/>
        </out-parameters>
        <actions>
            <set field="entityCount" from="[]"/>
            <entity-find entity-name="mantle.order.OrderPart" list="ordersPartList">
            </entity-find>
            <iterate list="ordersPartList" entry="entityInfo">
                <if condition="entityInfo.partTotal &lt; 20">
                    <then>
                        <set field="entityCount" from="entityCount+[orderId:entityInfo.orderId
                        ,orderPartSeqId:entityInfo.orderPartSeqId,partName:entityInfo.partName,statusId:entityInfo.statusId
                        ,vendorPartyId:entityInfo.vendorPartyId,customerPartyId:entityInfo.customerPartyId
                        ,facilityId:entityInfo.facilityId,partTotal:entityInfo.partTotal]"/>
                    </then>
                </if>
            </iterate>
        </actions>
    </service>

    <service verb="get" noun="OrderPartData" displayName="get the order part details">
        <in-parameters>
            <parameter name="facilityId" default-value="ZIRET_WH"/>
        </in-parameters>
        <out-parameters>
            <parameter name="orderPartLists" type="list" required="true"/>
        </out-parameters>
        <actions>
            <entity-find entity-name="mantle.order.OrderPart" list="ordersPartList">
                <econdition field-name="facilityId"/>
            </entity-find>
            <set field="orderPartLists" from="[orderId:ordersPartList.orderId
                        ,orderPartSeqId:ordersPartList.orderPartSeqId,partName:ordersPartList.partName
                        ,customerPartyId:ordersPartList.customerPartyId,facilityId:ordersPartList.facilityId]"/>
        </actions>
    </service>

    <service verb="get" noun="OrderPartsCount" displayName="get the order part count details">
        <in-parameters>
            <parameter name="customerPartyId" default-value="CustJqp"/>
        </in-parameters>
        <out-parameters>
            <parameter name="orderPartSeqId" type="list" required="true"/>
        </out-parameters>
        <actions>
            <entity-find-count entity-name="mantle.order.OrderPart" count-field="orderPartSeqId">
                <econdition field-name="customerPartyId"/>
            </entity-find-count>
        </actions>
    </service>

    <service verb="get" noun="OrderPartsInfo" displayName="get the order part details">
        <in-parameters>
            <parameter name="shipmentMethodEnumId" default-value="ShtMthGround"/>
            <parameter name="facilityId" default-value="ZIRET_WH"/>
        </in-parameters>
        <out-parameters>
            <parameter name="orderPartList" type="list" required="true"/>
        </out-parameters>
        <actions>
            <entity-find entity-name="mantle.order.OrderPart" list="orderPartList">
                <econdition field-name="shipmentMethodEnumId"/>
                <econdition field-name="facilityId"/>
            </entity-find>
        </actions>
    </service>

</services>
