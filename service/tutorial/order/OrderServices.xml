<?xml version="1.0" encoding="UTF-8"?>

<services xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/service-definition-2.1.xsd">

    <!-- Order & Related Services -->
    <service verb="create" noun="Order" displayName="Create the order">
        <in-parameters>
            <parameter name="orderName" required="true"/>
            <parameter name="currencyUomId" default-value="USD"/>
            <parameter name="salesChannelEnumId"/>
            <parameter name="statusId" default-value="OrderPlaced"/>
            <parameter name="productStoreId"/>
            <parameter name="placedDate" required="true"/>
            <parameter name="approvedDate"/>
        </in-parameters>
        <out-parameters>
            <parameter name="orderId" required="true"/>
        </out-parameters>
        <actions>
            <!--Create Order in the OrderHeader entity-->
            <service-call name="create#mantle.order.OrderHeader" in-map="context" out-map="context"/>
        </actions>
    </service>


    <service verb="create" noun="OrderPart" displayName="Create the order Part">
        <description>Create an Order items (OrderPart and OrderItem).</description>
        <in-parameters>
            <parameter name="orderId" required="true"/>
            <parameter name="partName"/>
            <parameter name="facilityId" required="true"/>
            <parameter name="shipmentMethodEnumId" default-value="ShMthGround"/>
            <parameter name="customerPartyId" required="true"/>
            <parameter name="item_details" type="List" required="true">
                <parameter name="orderEntry" type="Map">
                    <parameter name="productId" required="true"/>
                    <parameter name="itemDescription"/>
                    <parameter name="quantity" required="true"/>
                    <parameter name="unitAmount" required="true"/>
                    <parameter name="orderPartSeqId"/>
                </parameter>
            </parameter>
        </in-parameters>
        <out-parameters>
            <parameter name="orderId" required="true"/>
            <parameter name="orderPartSeqId" required="true"/>
        </out-parameters>
        <actions>
            <!-- Finding existing  orderId in the OrderHeader entity -->
            <entity-find-count entity-name="mantle.order.OrderHeader" count-field="orderCount">
                <econdition field-name="orderId"/>
            </entity-find-count>
            <!-- If orderId exist then create order part in the OrderPart entity -->
            <if condition="orderCount==1">
                <then>
                    <service-call name="create#mantle.order.OrderPart" in-map="context" out-map="context"/>
                </then>
                <else>
                    <!-- If orderId doesn't exist then return an error -->
                    <return error="true" message="OrderId doesn't exists in the OrderHeader entity [${orderId}]."/>
                </else>
            </if>
            <set field="orderPartSeqId" from="context.orderPartSeqId"/>
            <iterate list="item_details" entry="product">
                <set field="productId" from="product.productId"/>
                <!-- Finding existing productId in the Product entity -->
                <entity-find-one entity-name="mantle.product.Product" value-field="productList">
                    <field-map field-name="productId"/>
                </entity-find-one>
                <!-- If productId exist then create order items in the OrderItem entity -->
                <if condition="productList">
                    <then>
                        <service-call name="create#mantle.order.OrderItem" in-map="[orderId:orderId,orderPartSeqId:orderPartSeqId,productId:product.productId,
                                  itemDescription:product.itemDescription,
                                  unitAmount:product.unitAmount,quantity:product.quantity]"
                                      out-map="context"/>
                    </then>
                    <else>
                        <!-- If productId doesn't exist then return an error -->
                        <return error="true"
                                message="productId doesn't exists in the Product entity [${productId}]."/>
                    </else>
                </if>
            </iterate>
        </actions>
    </service>


    <service verb="store" noun="OrderHeader" displayName="Update the order">
        <in-parameters>
            <parameter name="orderId" required="true"/>
            <parameter name="orderName"/>
            <parameter name="currencyUomId"/>
            <parameter name="salesChannelEnumId"/>
            <parameter name="statusId"/>
            <parameter name="productStoreId"/>
            <parameter name="placedDate"/>
            <parameter name="approvedDate"/>
            <parameter name="grandTotal"/>
        </in-parameters>
        <out-parameters>
            <parameter name="orderId" required="true"/>
            <parameter name="orderName" required="true"/>
            <parameter name="currencyUomId" required="true"/>
            <parameter name="salesChannelEnumId" required="true"/>
            <parameter name="statusId" required="true"/>
            <parameter name="productStoreId" required="true"/>
            <parameter name="placedDate" required="true"/>
            <parameter name="approvedDate" required="true"/>
            <parameter name="grandTotal" required="true"/>
        </out-parameters>
        <actions>
            <!-- Finding given orderId in the OrderHeader entity -->
            <entity-find-one entity-name="mantle.order.OrderHeader" value-field="orderUpdateList">
                <field-map field-name="orderId"/>
            </entity-find-one>
            <!-- If orderId exist then update the Order in the order OrderHeader entity -->
            <if condition="orderUpdateList">
                <then>
                    <service-call name="update#mantle.order.OrderHeader" in-map="context" out-map="context"/>
                </then>
            </if>
        </actions>
    </service>


    <service verb="get" noun="OrderDisplayInfo">
        <description>The OrderDisplayInfo service should return information about an order by giving its order id.
        </description>
        <in-parameters>
            <parameter name="orderId" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="orders" type="list">
                <parameter name="orderId" required="true"/>
                <parameter name="orderName" required="true"/>
                <parameter name="currencyUomId" required="true"/>
                <parameter name="salesChannelEnumId" required="true"/>
                <parameter name="statusId" required="true"/>
                <parameter name="placedDate" required="true"/>
                <parameter name="grandTotal" required="true"/>
                <parameter name="customers_deatails" type="map">
                    <parameter name="partyId" required="true"/>
                    <parameter name="firstName" required="true"/>
                    <parameter name="middleName" required="true"/>
                    <parameter name="lastName" required="true"/>
                </parameter>
                <parameter name="order_parts" type="list">
                    <parameter name="orderparts" type="map">
                        <parameter name="orderPartSeqId" required="true"/>
                        <parameter name="partName" required="true"/>
                        <parameter name="facilityId" required="true"/>
                        <parameter name="shipmentMethodEnumId" required="true"/>
                        <parameter name="partStatusId" required="true"/>
                        <parameter name="partTotal" required="true"/>
                        <parameter name="item_details" type="list">
                            <parameter name="item_map" type="map">
                                <parameter name="orderItemSeqId" required="true"/>
                                <parameter name="productId" required="true"/>
                                <parameter name="itemDescription" required="true"/>
                                <parameter name="quantity" required="true"/>
                                <parameter name="unitAmount" required="true"/>
                            </parameter>
                        </parameter>
                    </parameter>
                </parameter>
            </parameter>
        </out-parameters>
        <actions>
            <set field="customers_deatails" from="[:]"/>
            <set field="orders" from="[]"/>
            <set field="order_parts" from="[]"/>
            <set field="item_details" from="[]"/>
            <!-- Finding given orderId in the OrderHeader entity -->
            <entity-find-one entity-name="mantle.order.OrderHeader" value-field="orderList">
                <field-map field-name="orderId"/>
                <select-field
                        field-name="orderId,orderName,currencyUomId,salesChannelEnumId,statusId,placedDate,grandTotal"/>
            </entity-find-one>
            <!-- If orderId exist in the OrderHeader entity then set the field with the help of orderList -->
            <set field="orderId" from="orderList.orderId"/>
            <set field="orderName" from="orderList.orderName"/>
            <set field="currencyUomId" from="orderList.currencyUomId"/>
            <set field="salesChannelEnumId" from="orderList.salesChannelEnumId"/>
            <set field="statusId" from="orderList.statusId"/>
            <set field="placedDate" from="orderList.placedDate"/>
            <set field="grandTotal" from="orderList.grandTotal"/>
            <!-- Finding the orderId in the OrderPart entity -->
            <entity-find entity-name="mantle.order.OrderPart" list="orderPartList">
                <econdition field-name="orderId"/>
                <select-field
                        field-name="orderId,orderPartSeqId,customerPartyId,partName,facilityId,shipmentMethodEnumId,statusId,partTotal"/>
            </entity-find>
            <!-- Finding the partyId in the Person entity -->
            <entity-find-one entity-name="mantle.party.Person" value-field="personMap">
                <field-map field-name="partyId" from="orderPartList.customerPartyId"/>
                <select-field field-name="partyId,firstName,middleName,lastName"/>
            </entity-find-one>
            <set field="partyId" from="personMap.partyId"/>
            <set field="firstName" from="personMap.firstName"/>
            <set field="middleName" from="personMap.middleName"/>
            <set field="lastName" from="personMap.lastName"/>
            <!-- Adding the person details in the customers_deatails map -->
            <set field="customers_deatails"
                 from="customers_deatails+[partyId:partyId,firstName:firstName,middleName:middleName,lastName:lastName]"/>
            <!-- Iterate orderPartList for getting orderPart details -->
            <iterate list="orderPartList" entry="ordersPart">
                <entity-find entity-name="mantle.order.OrderItem" list="orderItemList">
                    <econdition field-name="orderId" from="ordersPart.orderId"/>
                    <econdition field-name="orderPartSeqId" from="ordersPart.orderPartSeqId"/>
                    <select-field field-name="orderItemSeqId,productId,itemDescription,quantity,unitAmount"/>
                </entity-find>
                <!-- Iterate orderItemList for getting orderItem details -->
                <iterate list="orderItemList" entry="items">
                    <set field="orderItemSeqId" from="items.orderItemSeqId"/>
                    <set field="productId" from="items.productId"/>
                    <set field="itemDescription" from="items.itemDescription"/>
                    <set field="quantity" from="items.quantity"/>
                    <set field="unitAmount" from="items.unitAmount"/>
                    <!-- Set OrderItems details in the item_details list -->
                    <set field="item_details" from="item_details+[orderItemSeqId:orderItemSeqId,productId:productId,
                                    itemDescription:itemDescription,quantity:quantity,unitAmount:unitAmount]"/>
                </iterate>
                <!-- Set OrderPart details in the Order_parts list and also adding the item_details map in the Order_parts list -->
                <set field="order_parts" from="order_parts+[orderPartSeqId:ordersPart.orderPartSeqId,partName:ordersPart.partName,
                                facilityId:ordersPart.facilityId,shipmentMethodEnumId:ordersPart.shipmentMethodEnumId,
                     statusId:ordersPart.statusId,partTotal:ordersPart.partTotal,item_details:item_details]"/>
            </iterate>
            <!-- Set Order details in the orders list and also adding the order_parts list and customers_deatails map -->
            <set field="orders" from="orders+[orderId:orderId,orderName:orderName,currencyUomId:currencyUomId,salesChannelEnumId:salesChannelEnumId
                                    ,statusId:statusId,placedDate:placedDate,grandTotal:grandTotal,customers_deatails:customers_deatails,
                                            order_parts:order_parts]"/>
        </actions>
    </service>


    <service verb="get" noun="OrderDetails">
        <out-parameters>
            <parameter name="orders" type="list">
                <parameter name="orderId" required="true"/>
                <parameter name="orderName" required="true"/>
                <parameter name="currencyUomId" required="true"/>
                <parameter name="placedDate" required="true"/>
                <parameter name="grandTotal" required="true"/>
                <parameter name="customers_deatails" type="map">
                    <parameter name="partyId" required="true"/>
                    <parameter name="firstName" required="true"/>
                    <parameter name="middleName" required="true"/>
                    <parameter name="lastName" required="true"/>
                </parameter>
                <parameter name="order_parts" type="list">
                    <parameter name="orderparts" type="map">
                        <parameter name="orderPartSeqId" required="true"/>
                        <parameter name="partName" required="true"/>
                        <parameter name="facilityId" required="true"/>
                        <parameter name="shipmentMethodEnumId" required="true"/>
                        <parameter name="partStatusId" required="true"/>
                        <parameter name="partTotal" required="true"/>
                        <parameter name="item_details" type="list">
                            <parameter name="item_map" type="map">
                                <parameter name="orderItemSeqId" required="true"/>
                                <parameter name="productId" required="true"/>
                                <parameter name="itemDescription" required="true"/>
                                <parameter name="quantity" required="true"/>
                                <parameter name="unitAmount" required="true"/>
                            </parameter>
                        </parameter>

                    </parameter>
                </parameter>
            </parameter>
        </out-parameters>
        <actions>
            <set field="customers_deatails" from="[:]"/>
            <set field="orders" from="[]"/>
            <set field="order_parts" from="[]"/>
            <set field="item_details" from="[]"/>
            <set field="persons" from="[]"/>
            <!-- Getting all Order records of the OrderHeader entity -->
            <entity-find entity-name="mantle.order.OrderHeader" list="orderList">
                <select-field field-name="orderId,orderName,currencyUomId,placedDate,grandTotal"/>
            </entity-find>
            <!-- Iterate the orderList for getting order information -->
            <iterate list="orderList" entry="orderMap">
                <set field="orderId" from="orderMap.orderId"/>
                <set field="orderName" from="orderMap.orderName"/>
                <set field="currencyUomId" from="orderMap.currencyUomId"/>
                <set field="salesChannelEnumId" from="orderMap.salesChannelEnumId"/>
                <set field="statusId" from="orderMap.statusId"/>
                <set field="placedDate" from="orderMap.placedDate"/>
                <set field="grandTotal" from="orderMap.grandTotal"/>
                <entity-find entity-name="mantle.order.OrderPart" list="orderPartList">
                    <econdition field-name="orderId" from="orderMap.orderId"></econdition>
                    <select-field
                            field-name="orderId,orderPartSeqId,customerPartyId,partName,facilityId,shipmentMethodEnumId,statusId,partTotal"/>
                </entity-find>
                <iterate list="orderPartList" entry="orderPartMap">
           <?xml version="1.0" encoding="UTF-8"?>

<services xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/service-definition-2.1.xsd">

    <!-- Order & Related Services -->
    <service verb="create" noun="Order" displayName="Create the order">
        <in-parameters>
            <parameter name="orderName" required="true"/>
            <parameter name="currencyUomId" default-value="USD"/>
            <parameter name="salesChannelEnumId"/>
            <parameter name="statusId" default-value="OrderPlaced"/>
            <parameter name="productStoreId"/>
            <parameter name="placedDate" required="true"/>
            <parameter name="approvedDate"/>
        </in-parameters>
        <out-parameters>
            <parameter name="orderId" required="true"/>
        </out-parameters>
        <actions>
            <!--Create Order in the OrderHeader entity-->
            <service-call name="create#mantle.order.OrderHeader" in-map="context" out-map="context"/>
        </actions>
    </service>


    <service verb="create" noun="OrderPart" displayName="Create the order Part">
        <description>Create an Order items (OrderPart and OrderItem).</description>
        <in-parameters>
            <parameter name="orderId" required="true"/>
            <parameter name="partName"/>
            <parameter name="facilityId" required="true"/>
            <parameter name="shipmentMethodEnumId" default-value="ShMthGround"/>
            <parameter name="customerPartyId" required="true"/>
            <parameter name="item_details" type="List" required="true">
                <parameter name="orderEntry" type="Map">
                    <parameter name="productId" required="true"/>
                    <parameter name="itemDescription"/>
                    <parameter name="quantity" required="true"/>
                    <parameter name="unitAmount" required="true"/>
                    <parameter name="orderPartSeqId"/>
                </parameter>
            </parameter>
        </in-parameters>
        <out-parameters>
            <parameter name="orderId" required="true"/>
            <parameter name="orderPartSeqId" required="true"/>
        </out-parameters>
        <actions>
            <!-- Finding existing  orderId in the OrderHeader entity -->
            <entity-find-count entity-name="mantle.order.OrderHeader" count-field="orderCount">
                <econdition field-name="orderId"/>
            </entity-find-count>
            <!-- If orderId exist then create order part in the OrderPart entity -->
            <if condition="orderCount==1">
                <then>
                    <service-call name="create#mantle.order.OrderPart" in-map="context" out-map="context"/>
                </then>
                <else>
                    <!-- If orderId doesn't exist then return an error -->
                    <return error="true" message="OrderId doesn't exists in the OrderHeader entity [${orderId}]."/>
                </else>
            </if>
            <set field="orderPartSeqId" from="context.orderPartSeqId"/>
            <iterate list="item_details" entry="product">
                <set field="productId" from="product.productId"/>
                <!-- Finding existing productId in the Product entity -->
                <entity-find-one entity-name="mantle.product.Product" value-field="productList">
                    <field-map field-name="productId"/>
                </entity-find-one>
                <!-- If productId exist then create order items in the OrderItem entity -->
                <if condition="productList">
                    <then>
                        <service-call name="create#mantle.order.OrderItem" in-map="[orderId:orderId,orderPartSeqId:orderPartSeqId,productId:product.productId,
                                  itemDescription:product.itemDescription,
                                  unitAmount:product.unitAmount,quantity:product.quantity]"
                                      out-map="context"/>
                    </then>
                    <else>
                        <!-- If productId doesn't exist then return an error -->
                        <return error="true"
                                message="productId doesn't exists in the Product entity [${productId}]."/>
                    </else>
                </if>
            </iterate>
        </actions>
    </service>


    <service verb="store" noun="OrderHeader" displayName="Update the order">
        <in-parameters>
            <parameter name="orderId" required="true"/>
            <parameter name="orderName"/>
            <parameter name="currencyUomId"/>
            <parameter name="salesChannelEnumId"/>
            <parameter name="statusId"/>
            <parameter name="productStoreId"/>
            <parameter name="placedDate"/>
            <parameter name="approvedDate"/>
            <parameter name="grandTotal"/>
        </in-parameters>
        <out-parameters>
            <parameter name="orderId" required="true"/>
            <parameter name="orderName" required="true"/>
            <parameter name="currencyUomId" required="true"/>
            <parameter name="salesChannelEnumId" required="true"/>
            <parameter name="statusId" required="true"/>
            <parameter name="productStoreId" required="true"/>
            <parameter name="placedDate" required="true"/>
            <parameter name="approvedDate" required="true"/>
            <parameter name="grandTotal" required="true"/>
        </out-parameters>
        <actions>
            <!-- Finding given orderId in the OrderHeader entity -->
            <entity-find-one entity-name="mantle.order.OrderHeader" value-field="orderUpdateList">
                <field-map field-name="orderId"/>
            </entity-find-one>
            <!-- If orderId exist then update the Order in the order OrderHeader entity -->
            <if condition="orderUpdateList">
                <then>
                    <service-call name="update#mantle.order.OrderHeader" in-map="context" out-map="context"/>
                </then>
            </if>
        </actions>
    </service>


    <service verb="get" noun="OrderDisplayInfo">
        <description>The OrderDisplayInfo service should return information about an order by giving its order id.
        </description>
        <in-parameters>
            <parameter name="orderId" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="orders" type="list">
                <parameter name="orderId" required="true"/>
                <parameter name="orderName" required="true"/>
                <parameter name="currencyUomId" required="true"/>
                <parameter name="salesChannelEnumId" required="true"/>
                <parameter name="statusId" required="true"/>
                <parameter name="placedDate" required="true"/>
                <parameter name="grandTotal" required="true"/>
                <parameter name="customers_deatails" type="map">
                    <parameter name="partyId" required="true"/>
                    <parameter name="firstName" required="true"/>
                    <parameter name="middleName" required="true"/>
                    <parameter name="lastName" required="true"/>
                </parameter>
                <parameter name="order_parts" type="list">
                    <parameter name="orderparts" type="map">
                        <parameter name="orderPartSeqId" required="true"/>
                        <parameter name="partName" required="true"/>
                        <parameter name="facilityId" required="true"/>
                        <parameter name="shipmentMethodEnumId" required="true"/>
                        <parameter name="partStatusId" required="true"/>
                        <parameter name="partTotal" required="true"/>
                        <parameter name="item_details" type="list">
                            <parameter name="item_map" type="map">
                                <parameter name="orderItemSeqId" required="true"/>
                                <parameter name="productId" required="true"/>
                                <parameter name="itemDescription" required="true"/>
                                <parameter name="quantity" required="true"/>
                                <parameter name="unitAmount" required="true"/>
                            </parameter>
                        </parameter>
                    </parameter>
                </parameter>
            </parameter>
        </out-parameters>
        <actions>
            <set field="customers_deatails" from="[:]"/>
            <set field="orders" from="[]"/>
            <set field="order_parts" from="[]"/>
            <set field="item_details" from="[]"/>
            <!-- Finding given orderId in the OrderHeader entity -->
            <entity-find-one entity-name="mantle.order.OrderHeader" value-field="orderList">
                <field-map field-name="orderId"/>
                <select-field
                        field-name="orderId,orderName,currencyUomId,salesChannelEnumId,statusId,placedDate,grandTotal"/>
            </entity-find-one>
            <!-- If orderId exist in the OrderHeader entity then set the field with the help of orderList -->
            <set field="orderId" from="orderList.orderId"/>
            <set field="orderName" from="orderList.orderName"/>
            <set field="currencyUomId" from="orderList.currencyUomId"/>
            <set field="salesChannelEnumId" from="orderList.salesChannelEnumId"/>
            <set field="statusId" from="orderList.statusId"/>
            <set field="placedDate" from="orderList.placedDate"/>
            <set field="grandTotal" from="orderList.grandTotal"/>
            <!-- Finding the orderId in the OrderPart entity -->
            <entity-find entity-name="mantle.order.OrderPart" list="orderPartList">
                <econdition field-name="orderId"/>
                <select-field
                        field-name="orderId,orderPartSeqId,customerPartyId,partName,facilityId,shipmentMethodEnumId,statusId,partTotal"/>
            </entity-find>
            <!-- Finding the partyId in the Person entity -->
            <entity-find-one entity-name="mantle.party.Person" value-field="personMap">
                <field-map field-name="partyId" from="orderPartList.customerPartyId"/>
                <select-field field-name="partyId,firstName,middleName,lastName"/>
            </entity-find-one>
            <set field="partyId" from="personMap.partyId"/>
            <set field="firstName" from="personMap.firstName"/>
            <set field="middleName" from="personMap.middleName"/>
            <set field="lastName" from="personMap.lastName"/>
            <!-- Adding the person details in the customers_deatails map -->
            <set field="customers_deatails"
                 from="customers_deatails+[partyId:partyId,firstName:firstName,middleName:middleName,lastName:lastName]"/>
            <!-- Iterate orderPartList for getting orderPart details -->
            <iterate list="orderPartList" entry="ordersPart">
                <entity-find entity-name="mantle.order.OrderItem" list="orderItemList">
                    <econdition field-name="orderId" from="ordersPart.orderId"/>
                    <econdition field-name="orderPartSeqId" from="ordersPart.orderPartSeqId"/>
                    <select-field field-name="orderItemSeqId,productId,itemDescription,quantity,unitAmount"/>
                </entity-find>
                <!-- Iterate orderItemList for getting orderItem details -->
                <iterate list="orderItemList" entry="items">
                    <set field="orderItemSeqId" from="items.orderItemSeqId"/>
                    <set field="productId" from="items.productId"/>
                    <set field="itemDescription" from="items.itemDescription"/>
                    <set field="quantity" from="items.quantity"/>
                    <set field="unitAmount" from="items.unitAmount"/>
                    <!-- Set OrderItems details in the item_details list -->
                    <set field="item_details" from="item_details+[orderItemSeqId:orderItemSeqId,productId:productId,
                                    itemDescription:itemDescription,quantity:quantity,unitAmount:unitAmount]"/>
                </iterate>
                <!-- Set OrderPart details in the Order_parts list and also adding the item_details map in the Order_parts list -->
                <set field="order_parts" from="order_parts+[orderPartSeqId:ordersPart.orderPartSeqId,partName:ordersPart.partName,
                                facilityId:ordersPart.facilityId,shipmentMethodEnumId:ordersPart.shipmentMethodEnumId,
                     statusId:ordersPart.statusId,partTotal:ordersPart.partTotal,item_details:item_details]"/>
            </iterate>
            <!-- Set Order details in the orders list and also adding the order_parts list and customers_deatails map -->
            <set field="orders" from="orders+[orderId:orderId,orderName:orderName,currencyUomId:currencyUomId,salesChannelEnumId:salesChannelEnumId
                                    ,statusId:statusId,placedDate:placedDate,grandTotal:grandTotal,customers_deatails:customers_deatails,
                                            order_parts:order_parts]"/>
        </actions>
    </service>


    <service verb="get" noun="OrderDetails">
        <out-parameters>
            <parameter name="orders" type="list">
                <parameter name="orderId" required="true"/>
                <parameter name="orderName" required="true"/>
                <parameter name="currencyUomId" required="true"/>
                <parameter name="placedDate" required="true"/>
                <parameter name="grandTotal" required="true"/>
                <parameter name="customers_deatails" type="map">
                    <parameter name="partyId" required="true"/>
                    <parameter name="firstName" required="true"/>
                    <parameter name="middleName" required="true"/>
                    <parameter name="lastName" required="true"/>
                </parameter>
                <parameter name="order_parts" type="list">
                    <parameter name="orderparts" type="map">
                        <parameter name="orderPartSeqId" required="true"/>
                        <parameter name="partName" required="true"/>
                        <parameter name="facilityId" required="true"/>
                        <parameter name="shipmentMethodEnumId" required="true"/>
                        <parameter name="partStatusId" required="true"/>
                        <parameter name="partTotal" required="true"/>
                        <parameter name="item_details" type="list">
                            <parameter name="item_map" type="map">
                                <parameter name="orderItemSeqId" required="true"/>
                                <parameter name="productId" required="true"/>
                                <parameter name="itemDescription" required="true"/>
                                <parameter name="quantity" required="true"/>
                                <parameter name="unitAmount" required="true"/>
                            </parameter>
                        </parameter>

                    </parameter>
                </parameter>
            </parameter>
        </out-parameters>
        <actions>
            <set field="customers_deatails" from="[:]"/>
            <set field="orders" from="[]"/>
            <set field="order_parts" from="[]"/>
            <set field="item_details" from="[]"/>
            <set field="persons" from="[]"/>
            <!-- Getting all Order records of the OrderHeader entity -->
            <entity-find entity-name="mantle.order.OrderHeader" list="orderList">
                <select-field field-name="orderId,orderName,currencyUomId,placedDate,grandTotal"/>
            </entity-find>
            <!-- Iterate the orderList for getting order information -->
            <iterate list="orderList" entry="orderMap">
                <set field="orderId" from="orderMap.orderId"/>
                <set field="orderName" from="orderMap.orderName"/>
                <set field="currencyUomId" from="orderMap.currencyUomId"/>
                <set field="salesChannelEnumId" from="orderMap.salesChannelEnumId"/>
                <set field="statusId" from="orderMap.statusId"/>
                <set field="placedDate" from="orderMap.placedDate"/>
                <set field="grandTotal" from="orderMap.grandTotal"/>
                <entity-find entity-name="mantle.order.OrderPart" list="orderPartList">
                    <econdition field-name="orderId" from="orderMap.orderId"></econdition>
                    <select-field
                            field-name="orderId,orderPartSeqId,customerPartyId,partName,facilityId,shipmentMethodEnumId,statusId,partTotal"/>
                </entity-find>
                <iterate list="orderPartList" entry="orderPartMap">
                    <entity-find-one entity-name="mantle.party.Person" value-field="personList">
                        <field-map field-name="partyId" from="orderPartMap.customerPartyId"/>
                        <select-field field-name="partyId,firstName,middleName,lastName"/>
                    </entity-find-one>
                    <set field="partyId" from="personList.partyId"/>
                    <set field="firstName" from="personList.firstName"/>
                    <set field="middleName" from="personList.middleName"/>
                    <set field="lastName" from="personList.lastName"/>
                    <!-- Adding the person details in the customers_deatails map -->
                    <set field="customers_deatails"
                         from="customers_deatails+[partyId:partyId,firstName:firstName,middleName:middleName,lastName:lastName]"/>
                    <entity-find entity-name="mantle.order.OrderItem" list="orderItemList">
                        <econdition field-name="orderId" from="orderPartMap.orderId"/>
                        <econdition field-name="orderPartSeqId" from="orderPartMap.orderPartSeqId"/>
                        <select-field field-name="orderItemSeqId,productId,itemDescription,quantity,unitAmount"/>
                    </entity-find>
                    <iterate list="orderItemList" entry="orderItemMap">
                        <set field="orderItemSeqId" from="orderItemMap.orderItemSeqId"/>
                        <set field="productId" from="orderItemMap.productId"/>
                        <set field="itemDescription" from="orderItemMap.itemDescription"/>
                        <set field="quantity" from="orderItemMap.quantity"/>
                        <set field="unitAmount" from="orderItemMap.unitAmount"/>
                        <!-- Set OrderItems details in the item_details list -->
                        <set field="item_details" from="item_details+[orderItemSeqId:orderItemSeqId,productId:productId,
                                    itemDescription:itemDescription,quantity:quantity,unitAmount:unitAmount]"/>
                    </iterate>
                    <!-- Set OrderPart details in the Order_parts list and also adding the item_details map in the Order_parts list -->
                    <set field="order_parts" from="order_parts+[orderPartSeqId:orderPartMap.orderPartSeqId,partName:orderPartMap.partName,
                                facilityId:orderPartMap.facilityId,shipmentMethodEnumId:orderPartMap.shipmentMethodEnumId,
                     statusId:orderPartMap.statusId,partTotal:orderPartMap.partTotal,item_details:item_details]"/>
                </iterate>
                <!-- Set Order details in the orders list and also adding the order_parts list and customers_deatails map -->
                <set field="orders" from="orders+[orderId:orderId,orderName:orderName,currencyUomId:currencyUomId,salesChannelEnumId:salesChannelEnumId
                                    ,statusId:statusId,placedDate:placedDate,grandTotal:grandTotal,customers_deatails:customers_deatails,
                                            order_parts:order_parts]"/>
            </iterate>

        </actions>
    </service>

</services>
         <entity-find-one entity-name="mantle.party.Person" value-field="personList">
                        <field-map field-name="partyId" from="orderPartMap.customerPartyId"/>
                        <select-field field-name="partyId,firstName,middleName,lastName"/>
                    </entity-find-one>
                    <set field="partyId" from="personList.partyId"/>
                    <set field="firstName" from="personList.firstName"/>
                    <set field="middleName" from="personList.middleName"/>
                    <set field="lastName" from="personList.lastName"/>
                    <!-- Adding the person details in the customers_deatails map -->
                    <set field="customers_deatails"
                         from="customers_deatails+[partyId:partyId,firstName:firstName,middleName:middleName,lastName:lastName]"/>
                    <entity-find entity-name="mantle.order.OrderItem" list="orderItemList">
                        <econdition field-name="orderId" from="orderPartMap.orderId"/>
                        <econdition field-name="orderPartSeqId" from="orderPartMap.orderPartSeqId"/>
                        <select-field field-name="orderItemSeqId,productId,itemDescription,quantity,unitAmount"/>
                    </entity-find>
                    <iterate list="orderItemList" entry="orderItemMap">
                        <set field="orderItemSeqId" from="orderItemMap.orderItemSeqId"/>
                        <set field="productId" from="orderItemMap.productId"/>
                        <set field="itemDescription" from="orderItemMap.itemDescription"/>
                        <set field="quantity" from="orderItemMap.quantity"/>
                        <set field="unitAmount" from="orderItemMap.unitAmount"/>
                        <!-- Set OrderItems details in the item_details list -->
                        <set field="item_details" from="item_details+[orderItemSeqId:orderItemSeqId,productId:productId,
                                    itemDescription:itemDescription,quantity:quantity,unitAmount:unitAmount]"/>
                    </iterate>
                    <!-- Set OrderPart details in the Order_parts list and also adding the item_details map in the Order_parts list -->
                    <set field="order_parts" from="order_parts+[orderPartSeqId:orderPartMap.orderPartSeqId,partName:orderPartMap.partName,
                                facilityId:orderPartMap.facilityId,shipmentMethodEnumId:orderPartMap.shipmentMethodEnumId,
                     statusId:orderPartMap.statusId,partTotal:orderPartMap.partTotal,item_details:item_details]"/>
                </iterate>
                <!-- Set Order details in the orders list and also adding the order_parts list and customers_deatails map -->
                <set field="orders" from="orders+[orderId:orderId,orderName:orderName,currencyUomId:currencyUomId,salesChannelEnumId:salesChannelEnumId
                                    ,statusId:statusId,placedDate:placedDate,grandTotal:grandTotal,customers_deatails:customers_deatails,
                                            order_parts:order_parts]"/>
            </iterate>

        </actions>
    </service>

</services>
